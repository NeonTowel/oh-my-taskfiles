version: '3'

vars:
  AWESOME_GIT_VERSION: "0.0.2"

tasks:
  install:linux:unzip:
    platforms: [linux]
    internal: true
    status:
      - command -v unzip >/dev/null 2>&1
    cmds:
      - |
        if command -v apt-get >/dev/null 2>&1; then
          sudo apt-get update && sudo apt-get install -y unzip
        elif command -v dnf >/dev/null 2>&1; then
          sudo dnf install -y unzip
        elif command -v yum >/dev/null 2>&1; then
          sudo yum install -y unzip
        elif command -v pacman >/dev/null 2>&1; then
          sudo pacman -S --noconfirm unzip
        else
          echo "Unsupported package manager. Please install unzip manually."
          exit 1
        fi

  install:linux:
    platforms: [linux]
    desc: "[AWESOME-GIT] ✨ Install awesome-git"
    vars:
      APP_NAME: awesome-git
    cmds:
      - |
        if command -v {{ .APP_NAME }} >/dev/null 2>&1; then
          echo "{{ .APP_NAME }} is already installed."
          exit 0
        fi
      - task: install:linux:unzip
      - |
        curl -fsSL "https://github.com/NeonTowel/awesome-git/releases/download/{{ .AWESOME_GIT_VERSION }}/{{ .APP_NAME }}-linux.zip" -o /tmp/{{ .APP_NAME }}.zip
        unzip /tmp/{{ .APP_NAME }}.zip -d /tmp/{{ .APP_NAME }}
        chmod +x /tmp/{{ .APP_NAME }}/{{ .APP_NAME }}
        mv /tmp/{{ .APP_NAME }}/{{ .APP_NAME }} $HOME/bin/
        rm -rf /tmp/{{ .APP_NAME }}
        rm /tmp/{{ .APP_NAME }}.zip
        echo "{{ .APP_NAME }} has been installed successfully."

  install:windows:
    platforms: [windows]
    internal: true
    silent: true
    vars:
      APP_NAME: awesome-git
    cmds:
      - |
        if [ ! -d "$HOME/scoop/apps/{{ .APP_NAME }}/current" ]; then
          if ! scoop bucket list | grep -q "^neontowel"; then
            scoop bucket add neontowel https://github.com/neontowel/scoop-bucket
          fi
          scoop install neontowel/{{ .APP_NAME }}
          echo "{{ .APP_NAME }} has been installed successfully."
        fi
      

  install:
    desc: "[AWESOME-GIT] ✨ Install awesome-git"
    cmds:
      - task: install:windows
        platforms: [windows]
      - task: install:linux
        platforms: [linux]
