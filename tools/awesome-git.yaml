version: '3'

includes:
  LIB: ../lib.yaml
  TOOL: ../models/tool.yaml

tasks:
  default:
    - task: TOOL:default

  install:
    desc: "[AWESOME-GIT] âœ¨ Install awesome-git"
    cmds:
      - task: install:windows
        platforms: [windows]
      - task: install:linux
        platforms: [linux]

  uninstall:
    desc: "[AWESOME-GIT] ðŸ—‘ï¸  Uninstall awesome-git"
    cmds:
      - task: uninstall:linux
        platforms: [linux]
      - task: uninstall:windows
        platforms: [windows]

  update:
    desc: "[AWESOME-GIT] ðŸ”„ Update awesome-git to latest version"
    cmds:
      - task: update:linux
        platforms: [linux]
      - task: update:windows
        platforms: [windows]

  verify:
    desc: "[AWESOME-GIT] âœ… Verify awesome-git installation"
    cmds:
      - |
        if ! command -v awesome-git >/dev/null 2>&1; then
          task -t lib.yaml messaging:error MESSAGE="awesome-git not found in PATH"
          exit 1
        fi
        {{ .gum_ok }} "âœ… awesome-git found: $(command -v awesome-git)"
        version=$(awesome-git --version 2>&1 || echo "unknown")
        {{ .gum_info }} "ðŸ“‹ Version: $version"
        {{ .gum_ok }} "âœ… awesome-git is functional"

  install:linux:unzip:
    platforms: [linux]
    internal: true
    cmds:
      - task: LIB:linux-pkg:install
        vars:
          PACKAGE: unzip

  install:linux:
    platforms: [linux]
    internal: true
    deps: [install:linux:unzip]
    cmds:
      - task: LIB:github-release:install:zip
        vars:
          TOOL_NAME: awesome-git
          REPO: NeonTowel/awesome-git
          VERSION: "{{ .AWESOME_GIT_VERSION }}"
          ARCHIVE_NAME: "awesome-git-linux.zip"
          BINARY_PATH: "awesome-git/awesome-git"

  install:windows:
    platforms: [windows]
    internal: true
    silent: true
    cmds:
      - task: LIB:scoop:neontowel-install
        vars:
          APP: awesome-git

  uninstall:linux:
    internal: true
    platforms: [linux]
    cmds:
      - rm -f $HOME/bin/awesome-git
      - task: LIB:messaging:success
        vars:
          MESSAGE: "awesome-git uninstalled successfully"

  uninstall:windows:
    internal: true
    platforms: [windows]
    cmds:
      - task: LIB:scoop:uninstall
        vars:
          APP: awesome-git

  update:linux:
    internal: true
    platforms: [linux]
    cmds:
      - task: install:linux

  update:windows:
    internal: true
    platforms: [windows]
    cmds:
      - task: LIB:scoop:update
        vars:
          APP: awesome-git
