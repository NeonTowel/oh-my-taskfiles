version: '3'

vars:
  GUM_VERSION: "0.16.0"
  GUM_PRESENT:
    sh: command -v gum 2>/dev/null || true

  # These helper global template functions can be used in any taskfile to style output with gum.
  # If gum is not installed, the template function will use echo instead.
  # Example:
  # {{ .gum_info }} "This is an info message"
  # {{ .gum_warn }} "This is a warning message"
  # {{ .gum_error }} "This is an error message"
  # {{ .gum_ok }} "This is an ok message"
  gum_info: '{{ if .GUM_PRESENT }}gum style --foreground 240{{ else }}echo{{ end -}}'
  gum_warn: '{{ if .GUM_PRESENT }}gum style --foreground 208 --bold{{ else }}echo{{ end -}}'
  gum_error: '{{ if .GUM_PRESENT }}gum style --foreground 196 --bold{{ else }}echo{{ end -}}'
  gum_ok: '{{ if .GUM_PRESENT }}gum style --foreground 46 --bold{{ else }}echo{{ end -}}'

tasks:
  install:windows:
    internal: true
    platforms: [windows]
    cmds:
      - task: ::scoop:install
        vars:
          APP: charm-gum

  install:linux:
    internal: true
    platforms: [linux]
    cmds:
      - |
        if ! command -v gum >/dev/null 2>&1; then
          curl -fsSL "https://github.com/charmbracelet/gum/releases/download/v{{ .GUM_VERSION }}/gum_{{ .GUM_VERSION }}_Linux_x86_64.tar.gz" | sudo tar -xz -C $HOME/bin --strip-components=1 "gum_{{ .GUM_VERSION }}_Linux_x86_64/gum"
          echo "gum has been installed successfully."
        fi

  install:
    desc: "[GUM] âœ¨ Install gum"
    status:
      - "test -n '{{ .GUM_PRESENT }}'"
    cmds:
      - task: install:windows
      - task: install:linux
