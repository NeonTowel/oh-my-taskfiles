version: '3'

includes:
  lib: ../lib.yaml
  tool: ../models/tool.yaml

tasks:
  default:
    - task: tool:default

  install:windows:
    internal: true
    silent: true
    platforms: [windows]
    cmds:
      - task: lib:scoop:install
        vars:
          APP: lazygit

  install:linux:
    internal: true
    silent: true
    platforms: [linux]
    cmds:
      - task: lib:github-release:install:tarball
        vars:
          TOOL_NAME: lazygit
          REPO: jesseduffield/lazygit
          VERSION: "v{{ .LAZYGIT_VERSION }}"
          ARCHIVE_NAME: "lazygit_{{ .LAZYGIT_VERSION }}_Linux_x86_64.tar.gz"
          BINARY_PATH: lazygit
          STRIP_COMPONENTS: 0

  install:
    desc: "[LAZYGIT] âœ¨ Install lazygit"
    silent: true
    cmds:
      - task: install:windows
        platforms: [windows]
      - task: install:linux
        platforms: [linux]

  uninstall:
    desc: "[LAZYGIT] ðŸ—‘ï¸  Uninstall lazygit"
    silent: true
    cmds:
      - task: uninstall:linux
        platforms: [linux]
      - task: uninstall:windows
        platforms: [windows]

  update:
    desc: "[LAZYGIT] ðŸ”„ Update lazygit to latest version"
    silent: true
    cmds:
      - task: update:linux
        platforms: [linux]
      - task: update:windows
        platforms: [windows]

  verify:
    desc: "[LAZYGIT] âœ… Verify lazygit installation"
    cmds:
      - |
        if ! command -v lazygit >/dev/null 2>&1; then
          task -t lib.yaml messaging:error MESSAGE="lazygit not found in PATH"
          exit 1
        fi
        {{ .gum_ok }} "âœ… lazygit found: $(command -v lazygit)"
        version=$(lazygit --version 2>&1 || echo "unknown")
        {{ .gum_info }} "ðŸ“‹ Version: $version"
        if ! lazygit --help >/dev/null 2>&1; then
          task -t lib.yaml messaging:warning MESSAGE="lazygit --help failed - may not be functional"
        else
          {{ .gum_ok }} "âœ… lazygit is functional"
        fi

  uninstall:linux:
    internal: true
    silent: true
    platforms: [linux]
    cmds:
      - rm -f $HOME/bin/lazygit
      - task: lib:messaging:success
        vars:
          MESSAGE: "lazygit uninstalled successfully"

  uninstall:windows:
    internal: true
    silent: true
    platforms: [windows]
    cmds:
      - task: lib:scoop:uninstall
        vars:
          APP: lazygit

  update:linux:
    internal: true
    silent: true
    platforms: [linux]
    cmds:
      - task: install:linux

  update:windows:
    internal: true
    silent: true
    platforms: [windows]
    cmds:
      - task: lib:scoop:update
        vars:
          APP: lazygit