version: '3'

tasks:
  default:
    - task --list --taskfile tools/starship.yaml

  install:linux:
    platforms: [linux]
    internal: true
    cmds:
      - curl -sS 'https://starship.rs/install.sh' | sh -s -- -y -b $HOME/bin

  install:windows:
    platforms: [windows]
    internal: true
    cmds:
      - task: ::scoop:install
        vars:
          APP: starship

  install:
    desc: "[STARSHIP] âœ¨ Install and configure starship prompt"
    cmds:
      - task: install:linux
        platforms: [linux]
      - task: install:windows
        platforms: [windows]
      - task: configure

  uninstall:
    desc: "[STARSHIP] ðŸ—‘ï¸  Uninstall starship"
    cmds:
      - task: uninstall:linux
        platforms: [linux]
      - task: uninstall:windows
        platforms: [windows]

  update:
    desc: "[STARSHIP] ðŸ”„ Update starship to latest version"
    cmds:
      - task: update:linux
        platforms: [linux]
      - task: update:windows
        platforms: [windows]

  verify:
    desc: "[STARSHIP] âœ… Verify starship installation"
    cmds:
      - |
        if ! command -v starship >/dev/null 2>&1; then
          task :messaging:error MESSAGE="starship not found in PATH"
          exit 1
        fi
        {{ .gum_ok }} "âœ… starship found: $(command -v starship)"
        version=$(starship --version 2>&1 || echo "unknown")
        {{ .gum_info }} "ðŸ“‹ Version: $version"
        if [ -f "$HOME/.config/starship.toml" ]; then
          {{ .gum_ok }} "âœ… Configuration file exists"
        else
          {{ .gum_info }} "â„¹ï¸  Configuration file not found"
        fi
        if ! starship init bash >/dev/null 2>&1; then
          task :messaging:warning MESSAGE="starship init failed - may not be functional"
        else
          {{ .gum_ok }} "âœ… starship is functional"
        fi

  configure:
    internal: true
    cmds:
      - task: ::config-copy:copy-with-prompt
        vars:
          SOURCE_FILE: "$HOME/.omt/dotfiles/starship.toml"
          DEST_PATH: "$HOME/.config/starship.toml"
          TOOL_NAME: starship

  uninstall:linux:
    internal: true
    platforms: [linux]
    cmds:
      - rm -f $HOME/bin/starship
      - rm -f $HOME/.config/starship.toml
      - task: :messaging:success
        vars:
          MESSAGE: "starship uninstalled successfully"

  uninstall:windows:
    internal: true
    platforms: [windows]
    cmds:
      - task: ::scoop:uninstall
        vars:
          APP: starship

  update:linux:
    internal: true
    platforms: [linux]
    cmds:
      - task: install:linux

  update:windows:
    internal: true
    platforms: [windows]
    cmds:
      - task: ::scoop:update
        vars:
          APP: starship
