version: '3'

includes:
  lib: ../lib.yaml
  tool: ../models/tool.yaml

tasks:
  default:
    - task: tool:default

  install:
    platforms: [linux]
    desc: "[DIRENV] âœ¨ Install direnv"
    cmds:
      - task: lib:github-release:install:binary
        vars:
          TOOL_NAME: direnv
          REPO: direnv/direnv
          VERSION: "v{{ .DIRENV_VERSION }}"
          BINARY_NAME: "direnv.linux-amd64"

  uninstall:
    platforms: [linux]
    desc: "[DIRENV] ðŸ—‘ï¸  Uninstall direnv"
    cmds:
      - rm -f $HOME/bin/direnv
      - task: lib:messaging:success
        vars:
          MESSAGE: "direnv uninstalled successfully"

  update:
    platforms: [linux]
    desc: "[DIRENV] ðŸ”„ Update direnv to latest version"
    cmds:
      - task: install

  verify:
    platforms: [linux]
    desc: "[DIRENV] âœ… Verify direnv installation"
    cmds:
      - |
        if ! command -v direnv >/dev/null 2>&1; then
          task -t lib.yaml messaging:error MESSAGE="direnv not found in PATH"
          exit 1
        fi
        {{ .gum_ok }} "âœ… direnv found: $(command -v direnv)"
        version=$(direnv version 2>&1 || echo "unknown")
        {{ .gum_info }} "ðŸ“‹ Version: $version"
        if ! direnv --help >/dev/null 2>&1; then
          task -t lib.yaml messaging:warning MESSAGE="direnv --help failed - may not be functional"
        else
          {{ .gum_ok }} "âœ… direnv is functional"
        fi
