version: '3'

includes:
  buckets: 
    internal: true
    taskfile: scoop-buckets.yaml

tasks:
  install:
    platforms: [windows]
    internal: true
    requires:
      vars: [APP]
    status:
      - scoop list | findstr /C:"{{ .APP }}" >nul
    cmds:
      - defer: |
          {{if .EXIT_CODE}}
          task :messaging:install-error APP="{{ .APP }}" EXIT_CODE="{{.EXIT_CODE}}"
          {{end}}
      - scoop install {{ .APP }} || true
      - scoop list | findstr /C:"{{ .APP }}" >nul
      - task: :messaging:install-success
        vars: { APP: "{{ .APP }}" }

  uninstall:
    platforms: [windows]
    internal: true
    requires:
      vars: [APP]
    status:
      - '! scoop list | findstr /C:"{{ .APP }}" >nul'
    cmds:
      - scoop uninstall {{ .APP }}
      - task: :messaging:success
        vars:
          MESSAGE: "{{ .APP }} uninstalled successfully"

  update:
    platforms: [windows]
    internal: true
    requires:
      vars: [APP]
    cmds:
      - scoop update {{ .APP }}
      - task: :messaging:success
        vars:
          MESSAGE: "{{ .APP }} updated successfully"

  neontowel-install:
    platforms: [windows]
    internal: true
    requires:
      vars: [APP]
    cmds:
      - task: buckets:ensure
        vars: { BUCKET: "neontowel", BUCKET_URL: "https://github.com/NeonTowel/scoop-bucket"}
      - task: install
        vars: { APP: "{{ .APP }}" }

  extras-install:
    platforms: [windows]
    internal: true
    requires:
      vars: [APP]
    cmds:
      - task: buckets:ensure
        vars: { BUCKET: "extras" }
      - task: install
        vars: { APP: "{{ .APP }}" }

  nonportable-install:
    platforms: [windows]
    internal: true
    requires:
      vars: [APP]
    cmds:
      - task: buckets:ensure
        vars: { BUCKET: "nonportable" }
      - task: install
        vars: { APP: "{{ .APP }}" }

  nerd-fonts-install:
    platforms: [windows]
    internal: true
    requires:
      vars: [APP]
    cmds:
      - task: buckets:ensure
        vars: { BUCKET: "nerd-fonts" }
      - task: install
        vars: { APP: "{{ .APP }}" }
