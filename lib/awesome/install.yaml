version: '3'

tasks:
  tool:
    platforms: [windows]
    internal: true
    requires:
      vars: [ TOOL, POS, MAX ]
    label: "awesome-install:tool:{{ .TOOL }}"
    cmds:
      - task: lib:awesome:utils:header
        vars:
          TITLE: "Installing and configuring:"
          NAME: "{{ .TOOL }} üîß"
          POS: "{{ .POS }}"
          MAX: "{{ .MAX }}"
      - defer: |
          {{if .EXIT_CODE}}
          gum style \
            --foreground 196 --border-foreground 196 --border double \
            --align center --width 50 --margin "1 2" --padding "2 4" \
            ' ‚ùå ERROR ' 'Installation of {{ .TOOL }} failed with code {{.EXIT_CODE}}!'
          {{end}}
      - task: "tools:{{ .TOOL }}:install"
        vars:
          UNATTENDED: "true"

  app:
    platforms: [windows]
    internal: true
    requires:
      vars: [ APP, POS, MAX ]
    label: "awesome-install:app:{{ .APP }}"
    cmds:
      - task: lib:awesome:utils:header
        vars:
          TITLE: "Installing and configuring:"
          NAME: "{{ .APP }} üì¶"
          POS: "{{ .POS }}"
          MAX: "{{ .MAX }}"
      - defer: |
          {{if .EXIT_CODE}}
          gum style \
            --foreground 196 --border-foreground 196 --border double \
            --align center --width 50 --margin "1 2" --padding "2 4" \
            ' ‚ùå ERROR ' 'Installation of {{ .APP }} failed with code {{.EXIT_CODE}}!'
          {{end}}
      - task: "apps:{{ .APP }}:install"
        vars:
          UNATTENDED: "true"


  run:
    platforms: [windows]
    internal: true
    requires:
      vars: [ RUN ]
    label: "awesome-install:run:{{ .RUN }}"
    cmds:
      - task: lib:awesome:utils:header
        vars:
          TITLE: "Running omt-configuration:"
          NAME: "{{ .RUN }} üìÑ"
          POS: "{{ .POS }}"
          MAX: "{{ .MAX }}"
      - defer: |
          {{if .EXIT_CODE}}
          gum style \
            --foreground 196 --border-foreground 196 --border double \
            --align center --width 50 --margin "1 2" --padding "2 4" \
            ' ‚ùå ERROR ' 'Execution of {{ .RUN }} failed with code {{.EXIT_CODE}}!'
          {{end}}
      - task: "{{ .RUN }}"
        vars:
          UNATTENDED: "true"
