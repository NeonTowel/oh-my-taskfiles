version: '3'

tasks:
  install:
    platforms: [windows]
    silent: true
    requires:
      vars: [APP]
    status:
      - winget list --id "{{ .APP }}" --exact --accept-source-agreements --disable-interactivity
    cmds:
      - defer: |
          {{if .EXIT_CODE}}
          task :messaging:install-error APP="{{ .APP }}" EXIT_CODE="{{.EXIT_CODE}}"
          {{end}}
      - winget install --id "{{ .APP }}" --exact --accept-package-agreements --accept-source-agreements --disable-interactivity >nul
      - task: :messaging:install-success
        vars:
          APP: "{{ .APP }}"

  uninstall:
    platforms: [windows]
    silent: true
    requires:
      vars: [APP]
    cmds:
      - winget uninstall --id "{{ .APP }}" --exact --accept-source-agreements --disable-interactivity
      - task: :messaging:success
        vars:
          MESSAGE: "{{ .APP }} uninstalled successfully"

  update:
    platforms: [windows]
    silent: true
    requires:
      vars: [APP]
    cmds:
      - winget upgrade --id "{{ .APP }}" --exact --accept-package-agreements --accept-source-agreements --disable-interactivity
      - task: :messaging:success
        vars:
          MESSAGE: "{{ .APP }} updated successfully"