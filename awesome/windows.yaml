# Setup Awesome Windows Experience in one go :)
version: '3'

tasks:
  awesome-windows:
    deps: [ "tools:gum:install" ]
    internal: true
    platforms: [windows]
    vars:
      TOOLS:
        - 7zip
        - alacritty
        - awesome-git
        - az
        - azd
        - bat
        - btop
        - coreutils
        - flow-launcher
        - fonts
        - fzf
        - gcloud
        - glazewm
        - gomplate
        - gpg
        - gum
        - jq
        - k8s
        - lazygit
        - lsd
        - nvim
        - pwsh
        - rose-pine-cursor
        - starship
        - translucenttb
        - yasb
      APPS:
        - 1password
        - cursor
        - spotify
        - teracopy
        - postman
        - royal-ts
        - cryptomator
        - joplin
        - simplenote
        - podman-desktop
      RUN:
        - git:config-global
        - lang:go:install
        - lang:rust:install
        - lang:node:install
      TOOLS_COUNT: "{{ len .TOOLS }}"
      APPS_COUNT: "{{ len .APPS }}"
      RUN_COUNT: "{{ len .RUN }}"
    cmds:
      - |
        cat <<EOF | gum format --type=markdown | gum style \
          --border double \
          --padding "1 2" \
          --width 70 \
          --align left \
          --border-foreground 212 \
          --foreground 44
        # âœ¨ Welcome to the Awesome Windows Experience! âœ¨

        ## ðŸ”§ Tools to install

        | &nbsp;Name     | &nbsp;Name     | &nbsp;Name     |
        |----------------|----------------|----------------|
        {{- $cols := 3 -}}
        {{- $tools := .TOOLS -}}
        {{- $numRows := int (div (add (len $tools) (sub $cols 1)) $cols) -}}
        {{- range $row := until $numRows }}
        | {{- $idx0 := add $row (mul 0 $numRows) }}
          {{- if lt $idx0 (len $tools) }}&nbsp;{{ index $tools $idx0 }}&nbsp;{{ else }}   {{ end }} | 
          {{- $idx1 := add $row (mul 1 $numRows) }}
          {{- if lt $idx1 (len $tools) }}&nbsp;{{ index $tools $idx1 }}&nbsp;{{ else }}   {{ end }} | 
          {{- $idx2 := add $row (mul 2 $numRows) }}
          {{- if lt $idx2 (len $tools) }}&nbsp;{{ index $tools $idx2 }}&nbsp;{{ else }}   {{ end }} |
        {{- end }}

        ## ðŸ“¦ Applications to install

        | &nbsp;Name     | &nbsp;Name     | &nbsp;Name     |
        |----------------|----------------|----------------|
        {{- $cols := 3 -}}
        {{- $apps := .APPS -}}
        {{- $numRows := int (div (add (len $apps) (sub $cols 1)) $cols) -}}
        {{- range $row := until $numRows }}
        | {{- $idx0 := add $row (mul 0 $numRows) }}
          {{- if lt $idx0 (len $apps) }}&nbsp;{{ index $apps $idx0 }}&nbsp;{{ else }}   {{ end }} | 
          {{- $idx1 := add $row (mul 1 $numRows) }}
          {{- if lt $idx1 (len $apps) }}&nbsp;{{ index $apps $idx1 }}&nbsp;{{ else }}   {{ end }} | 
          {{- $idx2 := add $row (mul 2 $numRows) }}
          {{- if lt $idx2 (len $apps) }}&nbsp;{{ index $apps $idx2 }}&nbsp;{{ else }}   {{ end }} |
        {{- end }}

        ## ðŸ“„ Additional OMT-configurations to run

        {{- range .RUN }}
        - {{ . }}
        {{- end }}
        
        ---
        ðŸš€ *Press enter to embark on your legendary install quest...* ðŸš€

        EOF
        gum style --foreground 208 --align center --width 70 " "
        gum confirm --selected.background="#44d" --selected.foreground="#fff" "Are you sure you want to continue?"      

      - for: { var: TOOLS }
        task: "awesome-install:tool"
        vars:
          TOOL: "{{ .ITEM }}"
          POS: "{{$item := .ITEM}}{{range $index, $element := .TOOLS}}{{ if eq $element $item }}{{ add $index 1 }}{{end}}{{end}}"
          MAX: "{{ .TOOLS_COUNT }}"
      - for: { var: APPS }
        task: "awesome-install:app"
        vars:
          APP: "{{ .ITEM }}"
          POS: "{{$item := .ITEM}}{{range $index, $element := .APPS}}{{ if eq $element $item }}{{ add $index 1 }}{{end}}{{end}}"
          MAX: "{{ .APPS_COUNT }}"

      - for: { var: RUN }
        task: "awesome-install:run"
        vars:
          RUN: "{{ .ITEM }}"
          POS: "{{$item := .ITEM}}{{range $index, $element := .RUN}}{{ if eq $element $item }}{{ add $index 1 }}{{end}}{{end}}"
          MAX: "{{ .RUN_COUNT }}"

