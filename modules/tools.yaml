version: '3'

includes:
  common: 
    taskfile: common.yaml
    flatten: true

vars:
  TOOLS_ROOT_DIR: '{{ .ROOT_DIR }}/tools'

tasks:
  _help:
    internal: true
    vars:
      FILES:
        sh: task -t "{{ .ROOT_DIR }}/lib.yaml" modules:find-files PATH='{{ .TOOLS_ROOT_DIR }}' NAME='*.yaml' --silent
    cmds:
    - |
      {{ if eq .FILES "" }}
        echo "No tools found."
      {{ else }}
        echo "Tools available:"
        echo ""
        task -t "{{ .ROOT_DIR }}/lib.yaml" modules:pretty-print-files FILES='{{ .FILES }}' --silent
      {{ end }}
      echo ""
      echo "Usage: omt tools:<name>:[action] -- [options]"
      echo ""
      echo "See 'omt tools:<name>:help' for more information."

  '*:_help':
    vars:
      NAME: '{{ index .MATCH 0 }}'
    cmds:
    - |
      task -t "{{ .TOOLS_ROOT_DIR }}/{{ .NAME }}.yaml" tool:help --silent

  '*:_*':
    vars:
      NAME: '{{ index .MATCH 0 }}'
      ACTION: '{{ index .MATCH 1 }}'
    cmds:
    - |
      task -t "{{ .TOOLS_ROOT_DIR }}/{{ .NAME }}.yaml" {{ .ACTION }} --silent