version: '3'

vars:
  TOOLS_ROOT_DIR: '{{ .ROOT_DIR }}/tools'

tasks:
  default:
    desc: "Default 'tools' action without any arguments"
    cmds:
      - task: help

  help:
    desc: "Show help for 'tools' sub-command"
    aliases: ['list', 'ls']
    vars:
      FILES:
        sh: task -t "{{ .ROOT_DIR }}/lib.yaml" modules:find-files PATH='{{ .TOOLS_ROOT_DIR }}' NAME='*.yaml' --silent
    cmds:
    - |
      {{ if eq .FILES "" }}
        echo "No tools found."
      {{ else }}
        echo "Tools available:"
        echo ""
        task -t "{{ .ROOT_DIR }}/lib.yaml" modules:pretty-print-files FILES='{{ .FILES }}' --silent
      {{ end }}
      echo ""
      echo "Usage: omt tools:<name>:[action] -- [options]"
      echo ""
      echo "See 'omt tools:<name>:help' for more information."

  '*:help':
    desc: "Show help for tool '*'"
    vars:
      NAME: '{{ index .MATCH 0 }}'
    cmds:
    - |
      task -t "{{ .TOOLS_ROOT_DIR }}/{{ .NAME }}.yaml" tool:help --silent

  '*:*':
    desc: "Run action for tool"
    vars:
      NAME: '{{ index .MATCH 0 }}'
      ACTION: '{{ index .MATCH 1 }}'
    cmds:
    - |
      task -t "{{ .TOOLS_ROOT_DIR }}/{{ .NAME }}.yaml" {{ .ACTION }} --silent{{ if .CLI_VERBOSE }} --verbose{{ end }}